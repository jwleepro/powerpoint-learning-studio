# PPT Coach - Backend Specification

## 1. 개요

### 1.1 목적
PPT Coach 클라이언트 애플리케이션에 가이드 템플릿, 진행 상태, 검증 규칙 등의 데이터를 제공하는 백엔드 서버 명세

### 1.2 기술 스택
| 구분 | 기술 |
|------|------|
| Runtime | Node.js 20 LTS |
| Framework | Express.js / Fastify |
| Database | SQLite (로컬) / PostgreSQL (확장 시) |
| API | RESTful JSON API |

---

## 2. API 엔드포인트

### 2.1 템플릿 관리 API

#### GET /api/templates
가이드 템플릿 목록 조회

**Response**
```json
{
  "templates": [
    {
      "id": "result-report",
      "name": "결과완료보고서",
      "description": "프로젝트 결과를 보고하는 문서 템플릿",
      "stepCount": 8,
      "estimatedMinutes": 30
    }
  ]
}
```

#### GET /api/templates/:id
특정 템플릿 상세 조회

**Response**
```json
{
  "id": "result-report",
  "name": "결과완료보고서",
  "steps": [
    {
      "stepId": 1,
      "title": "슬라이드 크기 설정",
      "description": "표준 4:3 또는 와이드 16:9 선택",
      "slideIndex": 0,
      "checkpoints": [
        {
          "id": "cp-101",
          "text": "슬라이드 크기가 16:9로 설정됨",
          "validationType": "slide-size",
          "expectedValue": "16:9"
        }
      ],
      "highlights": [
        {
          "target": "menu",
          "path": "디자인 > 슬라이드 크기",
          "tooltip": "여기를 클릭하세요"
        }
      ]
    }
  ]
}
```

---

### 2.2 진행 상태 API

#### POST /api/sessions
새 가이드 세션 생성

**Request**
```json
{
  "templateId": "result-report",
  "userId": "user-123"
}
```

**Response**
```json
{
  "sessionId": "sess-abc-123",
  "templateId": "result-report",
  "currentStep": 1,
  "createdAt": "2025-01-15T09:00:00Z"
}
```

#### GET /api/sessions/:sessionId
세션 상태 조회

**Response**
```json
{
  "sessionId": "sess-abc-123",
  "templateId": "result-report",
  "currentStep": 3,
  "completedCheckpoints": ["cp-101", "cp-102", "cp-201"],
  "progress": 0.25,
  "lastUpdatedAt": "2025-01-15T09:15:00Z"
}
```

#### PATCH /api/sessions/:sessionId
세션 진행 상태 업데이트

**Request**
```json
{
  "currentStep": 4,
  "completedCheckpoints": ["cp-301"]
}
```

#### DELETE /api/sessions/:sessionId
세션 종료 및 삭제

---

### 2.3 검증 규칙 API

#### GET /api/validation-rules
검증 규칙 목록 조회

**Response**
```json
{
  "rules": [
    {
      "id": "font-consistency",
      "name": "폰트 일관성 검사",
      "description": "전체 슬라이드에서 폰트 종류/크기 통일 여부",
      "category": "typography",
      "severity": "warning",
      "params": {
        "allowedFonts": ["맑은 고딕", "나눔고딕"],
        "titleSize": [28, 32, 36],
        "bodySize": [14, 16, 18]
      }
    },
    {
      "id": "color-consistency",
      "name": "색상 일관성 검사",
      "description": "사용된 색상이 3가지 이내인지 확인",
      "category": "design",
      "severity": "warning",
      "params": {
        "maxColors": 3
      }
    },
    {
      "id": "slide-structure",
      "name": "슬라이드 구조 검사",
      "description": "필수 슬라이드 존재 여부",
      "category": "structure",
      "severity": "error",
      "params": {
        "requiredSlides": ["표지", "목차", "결론"]
      }
    }
  ]
}
```

---

## 3. 데이터 모델

> 상세 데이터베이스 스키마는 [04. database.md](./04.%20database.md) 참조

**주요 엔티티:**
- Template: 가이드 템플릿
- Step: 단계 정의
- Checkpoint: 체크포인트
- Highlight: 하이라이트 정보
- Session: 사용자 진행 상태

---

## 4. 비즈니스 로직

### 4.1 진행률 계산
```
progress = completedCheckpoints.length / totalCheckpoints.length
```

### 4.2 세션 자동 저장
- 체크포인트 완료 시 자동 저장
- 단계 이동 시 자동 저장
- 5분 간격 자동 저장 (클라이언트 트리거)

### 4.3 세션 복구
- 앱 재시작 시 마지막 활성 세션 조회
- `lastUpdatedAt` 기준 24시간 이내 세션만 복구 가능

---

## 5. 에러 코드

| 코드 | 설명 |
|------|------|
| ERR_TEMPLATE_NOT_FOUND | 요청한 템플릿이 존재하지 않음 |
| ERR_SESSION_NOT_FOUND | 세션을 찾을 수 없음 |
| ERR_SESSION_EXPIRED | 세션이 만료됨 (24시간 초과) |
| ERR_INVALID_STEP | 유효하지 않은 단계 번호 |
| ERR_CHECKPOINT_INVALID | 체크포인트 검증 실패 |

---

## 6. 관련 요구사항 매핑

| 요구사항 ID | API/기능 |
|-------------|----------|
| FR-201 | GET /api/templates |
| FR-202 | GET /api/templates/:id (steps, checkpoints) |
| FR-203 | GET /api/sessions/:sessionId (progress) |
| FR-204 | PATCH /api/sessions/:sessionId |
| FR-207 | POST/GET/PATCH /api/sessions |
| FR-401~405 | GET /api/validation-rules |
