# PPT Coach - Unit Test Best Practices

## 1. í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ì„ íƒ

### Frontend (C# / WPF)

| í”„ë ˆì„ì›Œí¬ | ìš©ë„ | ì¶”ì²œ ì´ìœ  |
|------------|------|-----------|
| **xUnit** | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | .NET í‘œì¤€, ë³‘ë ¬ ì‹¤í–‰, ê¹”ë”í•œ ë¬¸ë²• |
| **NSubstitute** | Mocking | COM Interop ëª¨í‚¹ì— ì í•©, ì§ê´€ì  API |
| **FluentAssertions** | Assertion | ê°€ë…ì„± ë†’ì€ assertion ë¬¸ë²• |
| **Moq** | Mocking ëŒ€ì•ˆ | ë„ë¦¬ ì‚¬ìš©ë¨, ë¬¸ì„œ í’ë¶€ |

### Backend (Node.js)

| í”„ë ˆì„ì›Œí¬ | ìš©ë„ | ì¶”ì²œ ì´ìœ  |
|------------|------|-----------|
| **Vitest** / **Jest** | ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ | ë¹ ë¥¸ ì†ë„, TypeScript ì§€ì› |
| **Supertest** | API í…ŒìŠ¤íŠ¸ | Express/Fastify í†µí•© í…ŒìŠ¤íŠ¸ |
| **better-sqlite3** | DB í…ŒìŠ¤íŠ¸ | ì¸ë©”ëª¨ë¦¬ SQLiteë¡œ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ |

---

## 2. í…ŒìŠ¤íŠ¸ êµ¬ì¡° (ì¶”ì²œ íŒ¨í„´)

---

## 3. í•µì‹¬ í…ŒìŠ¤íŠ¸ ì „ëµ

### 3.1 COM Interop í…ŒìŠ¤íŠ¸ (ê°€ì¥ ì¤‘ìš”)

PowerPoint COM ê°ì²´ëŠ” ì§ì ‘ í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ìš°ë¯€ë¡œ **Interface ì¶”ìƒí™”** í•„ìˆ˜:

```csharp
// ì¸í„°í˜ì´ìŠ¤ ì •ì˜
public interface IPowerPointService
{
    bool Connect();
    int GetCurrentSlideIndex();
    SlideInfo GetSlideInfo(int index);
    void AddSlide(int position);
}

// í…ŒìŠ¤íŠ¸ì—ì„œ Mock ì‚¬ìš©
[Fact]
public void GetSlideInfo_ReturnsCorrectSlideIndex()
{
    // Arrange
    var mockPptService = Substitute.For<IPowerPointService>();
    mockPptService.GetCurrentSlideIndex().Returns(3);

    var viewModel = new GuideViewModel(mockPptService);

    // Act
    var slideIndex = viewModel.CurrentSlideIndex;

    // Assert
    slideIndex.Should().Be(3);
}
```

**ì£¼ìš” í¬ì¸íŠ¸:**
- COM ê°ì²´ ì§ì ‘ ì˜ì¡´ì„± ì œê±°
- ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì„¤ê³„ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„± í™•ë³´
- Mock ê°ì²´ë¡œ PowerPoint ì—†ì´ë„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

---

## 4. í…ŒìŠ¤íŠ¸ ìš°ì„ ìˆœìœ„ (ë¬¸ì„œ ê¸°ë°˜)

| ìš°ì„ ìˆœìœ„ | ì˜ì—­ | í…ŒìŠ¤íŠ¸ ëŒ€ìƒ | ì´ìœ  | ë§¤í•‘ |
|----------|------|-------------|------|------|
| **1** | ê²€ì¦ ë¡œì§ | Validators | í•µì‹¬ ê¸°ëŠ¥, ìˆœìˆ˜ í•¨ìˆ˜ë¡œ í…ŒìŠ¤íŠ¸ ìš©ì´ | FR-401~405 |
| **2** | ì„¸ì…˜ ê´€ë¦¬ | SessionService | ë°ì´í„° ì†ì‹¤ ë°©ì§€ ì¤‘ìš” | FR-207 |
| **3** | API ë ˆì´ì–´ | Backend endpoints | ê³„ì•½ ê²€ì¦ | Backend Spec |
| **4** | ViewModel | GuideViewModel, OverlayViewModel | MVVM ë¡œì§ | FR-203~204 |
| **5** | COM Wrapper | PowerPointService | í†µí•© í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦ | FR-101~107 |

---

## 5. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ

```
ğŸ“Š ê¶Œì¥ ì»¤ë²„ë¦¬ì§€
â”œâ”€â”€ Services/          90%+  (í•µì‹¬ ë¡œì§)
â”œâ”€â”€ Validators/        95%+  (ëª¨ë“  ê·œì¹™)
â”œâ”€â”€ ViewModels/        80%+  (ë°”ì¸ë”© ë¡œì§)
â”œâ”€â”€ Models/            70%+  (ë°ì´í„° êµ¬ì¡°)
â””â”€â”€ COM Interop/       60%+  (í†µí•© í…ŒìŠ¤íŠ¸ ìœ„ì£¼)
```

**ì¸¡ì • ë„êµ¬:**
- Frontend: `coverlet.collector` + `ReportGenerator`
- Backend: `c8` (for Vitest) ë˜ëŠ” Jest built-in coverage

---

## 6. í”„ë¡œì íŠ¸ ì„¤ì • ì˜ˆì‹œ

### 6.1 Frontend í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸

```xml
<!-- PPTCoach.Tests.csproj -->
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net8.0-windows</TargetFramework>
    <IsPackable>false</IsPackable>
    <IsTestProject>true</IsTestProject>
  </PropertyGroup>

  <ItemGroup>
    <!-- í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ -->
    <PackageReference Include="xunit" Version="2.6.6" />
    <PackageReference Include="xunit.runner.visualstudio" Version="2.5.6" />

    <!-- Mocking -->
    <PackageReference Include="NSubstitute" Version="5.1.0" />

    <!-- Assertions -->
    <PackageReference Include="FluentAssertions" Version="6.12.0" />

    <!-- ì»¤ë²„ë¦¬ì§€ -->
    <PackageReference Include="coverlet.collector" Version="6.0.0" />

    <!-- í…ŒìŠ¤íŠ¸ SDK -->
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\PPTCoach\PPTCoach.csproj" />
  </ItemGroup>
</Project>
```

### 6.2 Backend í…ŒìŠ¤íŠ¸ ì„¤ì •

```json
// package.json
{
  "scripts": {
    "test": "vitest",
    "test:watch": "vitest --watch",
    "test:coverage": "vitest --coverage",
    "test:ui": "vitest --ui"
  },
  "devDependencies": {
    "vitest": "^1.2.0",
    "@vitest/ui": "^1.2.0",
    "@vitest/coverage-v8": "^1.2.0",
    "supertest": "^6.3.4",
    "better-sqlite3": "^9.3.0"
  }
}
```

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    globals: true,
    environment: 'node',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.config.ts'
      ],
      lines: 80,
      functions: 80,
      branches: 75,
      statements: 80
    }
  }
});
```

---

## 7. í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œë¼ì¸

### 7.1 Naming Convention

```csharp
// íŒ¨í„´: MethodName_StateUnderTest_ExpectedBehavior
[Fact]
public void AddSlide_WhenIndexValid_AddsSlideAtCorrectPosition()
{
    // ...
}

[Fact]
public void Connect_WhenPowerPointNotRunning_ThrowsException()
{
    // ...
}
```

### 7.2 AAA íŒ¨í„´ (Arrange-Act-Assert)

```csharp
[Fact]
public void Example_Test()
{
    // Arrange - í…ŒìŠ¤íŠ¸ ì¤€ë¹„
    var service = new MyService();
    var input = new Input { Value = 10 };

    // Act - ì‹¤í–‰
    var result = service.Process(input);

    // Assert - ê²€ì¦
    result.Should().Be(20);
}
```

### 7.3 í…ŒìŠ¤íŠ¸ ë…ë¦½ì„±

ê° í…ŒìŠ¤íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•´ì•¼ í•¨:

```csharp
public class DatabaseTestsExample : IDisposable
{
    private readonly InMemoryDatabase _db;

    public DatabaseTestsExample()
    {
        // ê° í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ìƒˆ DB ì¸ìŠ¤í„´ìŠ¤
        _db = new InMemoryDatabase();
    }

    public void Dispose()
    {
        _db.Dispose();
    }

    [Fact]
    public void Test1()
    {
        // _dbëŠ” ê¹¨ë—í•œ ìƒíƒœ
    }

    [Fact]
    public void Test2()
    {
        // Test1ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠìŒ
    }
}
```
---

## 11. ìš”ì•½ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‹œì‘ ì „ í™•ì¸ ì‚¬í•­

- [ ] xUnit, NSubstitute, FluentAssertions íŒ¨í‚¤ì§€ ì„¤ì¹˜
- [ ] í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
- [ ] COM Interopì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ ì¶”ìƒí™” ì„¤ê³„
- [ ] í…ŒìŠ¤íŠ¸ ë°ì´í„° Fixture ì¤€ë¹„

### ìš°ì„  ì‘ì„±í•  í…ŒìŠ¤íŠ¸

1. [ ] ê²€ì¦ ê·œì¹™ í…ŒìŠ¤íŠ¸ (FR-401~405)
2. [ ] ì„¸ì…˜ ê´€ë¦¬ í…ŒìŠ¤íŠ¸ (FR-207)
3. [ ] ViewModel ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4. [ ] API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

### ì§€ì†ì  ìœ ì§€ ì‚¬í•­

- [ ] ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ í…ŒìŠ¤íŠ¸ í•¨ê»˜ ì‘ì„±
- [ ] ì»¤ë²„ë¦¬ì§€ 80% ì´ìƒ ìœ ì§€
- [ ] PR ì „ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

---

## ì°¸ê³  ë¬¸ì„œ

- [01. requirements.md](./01.%20requirements.md) - ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­
- [02. backend_spec.md](./02.%20backend_spec.md) - API ëª…ì„¸
- [03. frontend_spec.md](./03.%20frontend_spec.md) - Frontend êµ¬ì¡°
- [06. todo.md](./06.%20todo.md) - ê°œë°œ ì§„í–‰ ìƒí™©
